<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관심 종목 입력</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #e0e7ff 0%, #f8fafc 100%);
            min-height: 100vh;
            font-family: 'Noto Sans KR', sans-serif;
        }
        .center-box {
            max-width: 1000px;
            margin: 80px auto;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
            padding: 2.5rem 2rem 2rem 2rem;
        }
        .form-label {
            font-weight: 600;
        }
        .btn-primary {
            width: 100%;
            font-weight: 600;
            letter-spacing: 1px;
        }
        h1 {
            font-size: 1.7rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #3b82f6;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="center-box">
        <h1>관심 종목을 입력하세요</h1> 
        <form action="" method="POST">
            {% csrf_token %}
            <div class="mb-3">
                <label for="company_name" class="form-label">회사명 또는 종목명</label>
                <input type="text" class="form-control" id="company_name" name="company_name" placeholder="예: 토스, 삼성전자" required>
            </div>
            <button type="submit" class="btn btn-primary">검색</button>
        </form>
    </div>

    {% if comments %}
    <div class="center-box mt-4">
        <h2 class="mb-3" style="font-size:1.2rem; color:#2563eb; text-align:center;">여론 분석 결과</h2>
        {% for company, analysis in sentiment_analysis.items %}
        <div class="mb-4 p-4 border rounded" style="background-color: #f8f9fa;">
            <div class="d-flex align-items-center mb-3">
                <h5 class="mb-0 me-3 text-primary">{{ company }}</h5>
                {% if analysis.sentiment == '긍정' %}
                    <span class="badge bg-success fs-6 px-3 py-2">{{ analysis.sentiment }}</span>
                {% elif analysis.sentiment == '부정' %}
                    <span class="badge bg-danger fs-6 px-3 py-2">{{ analysis.sentiment }}</span>
                {% else %}
                    <span class="badge bg-secondary fs-6 px-3 py-2">{{ analysis.sentiment }}</span>
                {% endif %}
            </div>
            <div class="p-3 rounded" style="background-color: white; border-left: 4px solid #2563eb;">
                <p class="mb-2" style="font-size: 1.1rem; line-height: 1.6; color: #333;">
                    {{ analysis.summary }}
                </p>
                <small class="text-muted">총 {{ analysis.total_count }}개의 댓글 분석</small>
            </div>
        </div>
        {% empty %}
        <div class="text-center p-4">
            <p class="text-muted">분석할 댓글이 없습니다.</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if comments %}
    <div class="center-box mt-4">
        <h2 class="mb-3" style="font-size:1.2rem; color:#2563eb; text-align:center;">커뮤니티 댓글</h2>
        <ul class="list-group">
            {% for comment in comments %}
            <li class="list-group-item d-flex align-items-center" style="gap: 12px;">
                <div class="flex-grow-1 text-break" style="min-width:0;">
                    <span class="badge bg-primary me-2 align-middle text-light" style="height:calc(1.5em + 0.5rem + 2px); display:inline-flex; align-items:center; font-size:0.875rem; padding:0.25em 0.6em; background-color:#e5e7eb; color:#333;">{{ comment.company_name }}</span>
                    <span style="word-break:break-all;">{{ comment.content }}</span>
                </div>
                <div class="d-flex flex-row gap-4 align-items-end flex-shrink-0" style="min-width:110px;">
                    <span class="text-muted mb-1" style="font-size:0.85em;">{{ comment.created_at|date:'Y-m-d H:i' }}</span>
                    <form action="{% url 'crawlings:delete_comment' comment.id %}" method="post" style="display:inline;">
                        {% csrf_token %}
                                                <button type="submit" class="btn btn-sm align-middle p-0" style="background:transparent; border:none; vertical-align:middle;" title="삭제" onclick="return confirm('정말 삭제하시겠습니까?');">
                                                    <svg xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd" viewBox="0 0 456 511.82" width="20" height="20"><path fill="#999999" d="M48.42 140.13h361.99c17.36 0 29.82 9.78 28.08 28.17l-30.73 317.1c-1.23 13.36-8.99 26.42-25.3 26.42H76.34c-13.63-.73-23.74-9.75-25.09-24.14L20.79 168.99c-1.74-18.38 9.75-28.86 27.63-28.86zM24.49 38.15h136.47V28.1c0-15.94 10.2-28.1 27.02-28.1h81.28c17.3 0 27.65 11.77 27.65 28.01v10.14h138.66c.57 0 1.11.07 1.68.13 10.23.93 18.15 9.02 18.69 19.22.03.79.06 1.39.06 2.17v42.76c0 5.99-4.73 10.89-10.62 11.19-.54 0-1.09.03-1.63.03H11.22c-5.92 0-10.77-4.6-11.19-10.38 0-.72-.03-1.47-.03-2.23v-39.5c0-10.93 4.21-20.71 16.82-23.02 2.53-.45 5.09-.37 7.67-.37zm83.78 208.38c-.51-10.17 8.21-18.83 19.53-19.31 11.31-.49 20.94 7.4 21.45 17.57l8.7 160.62c.51 10.18-8.22 18.84-19.53 19.32-11.32.48-20.94-7.4-21.46-17.57l-8.69-160.63zm201.7-1.74c.51-10.17 10.14-18.06 21.45-17.57 11.32.48 20.04 9.14 19.53 19.31l-8.66 160.63c-.52 10.17-10.14 18.05-21.46 17.57-11.31-.48-20.04-9.14-19.53-19.32l8.67-160.62zm-102.94.87c0-10.23 9.23-18.53 20.58-18.53 11.34 0 20.58 8.3 20.58 18.53v160.63c0 10.23-9.24 18.53-20.58 18.53-11.35 0-20.58-8.3-20.58-18.53V245.66z"/></svg>
                                                </button>
                    </form>
                </div>
            </li>
            {% empty %}
            <li class="list-group-item">아직 저장된 댓글이 없습니다.</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    

    <!-- Bootstrap JS (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
